apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  labels:
    app.kubernetes.io/instance: elasticsearch
  name: combo
  namespace: elastic-mon
spec:
  monitoring:
    logs:
      elasticsearchRefs:
        - name: monitoring
    metrics:
      elasticsearchRefs:
        - name: monitoring
  nodeSets:
    - config:
        node.roles: ["data", "master", "ingest"]
      count: 1
      name: combo
      podTemplate:
        spec:
          containers:
            - env:
                - name: ES_JAVA_OPTS
                  value: '-Xms2g -Xmx2g'
              name: elasticsearch
              resources:
                limits: {}
                requests:
                  cpu: 250m
                  memory: 4Gi
          initContainers:
            - command:
                - /bin/bash
                - '-exc'
                - |
                  CURRENT=`sysctl -n vm.max_map_count`;
                  DESIRED="262144";
                  if [ "$DESIRED" -gt "$CURRENT" ]; then
                      sysctl -w vm.max_map_count=262144;
                  fi;
                  CURRENT=`sysctl -n fs.file-max`;
                  DESIRED="65536";
                  if [ "$DESIRED" -gt "$CURRENT" ]; then
                      sysctl -w fs.file-max=65536;
                  fi;
              image: 'docker.io/bitnami/bitnami-shell:10-debian-10-r248'
              imagePullPolicy: IfNotPresent
              name: sysctl
              resources:
